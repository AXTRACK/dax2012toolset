Exportfile for AOT version 1.0 or later
Formatversion: 1

***Element: FRM

; Microsoft Dynamics AX Forms unloaded
; --------------------------------------------------------------------------------
FRMVERSION 12

FORM #DEV_xRefIcons
  PROPERTIES
    Name                #DEV_xRefIcons
    Origin              #{F80764DB-A7FF-453D-81DD-8F3DC2E70E5A}
  ENDPROPERTIES
  
  METHODS
    SOURCE #classDeclaration
      #public class FormRun extends ObjectRun
      #{
      #    ImageList           imageList;
      #    Map                 resIdMap;
      #}
    ENDSOURCE
    SOURCE #init
      #public void init()
      #{
      #    Image               image = new Image();
      #    DEV_xRefElements    xRefElements;
      #    int                 i = 0;
      #
      #    super();
      #
      #    resIdMap = new Map(Types::Integer, Types::Integer);
      #
      #    imageList = new ImageList(ImageList::iconWidth(), ImageList::iconHeight());
      #
      #    while select ImageRes from xRefElements
      #        group by ImageRes
      #        where xRefElements.Type == UtilElementType::Resource
      #    {
      #        if(Image::validResource(xRefElements.ImageRes))
      #        {
      #            resIdMap.insert(xRefElements.ImageRes, i);
      #            image.loadResource(xRefElements.ImageRes);
      #            imageList.add(image);
      #
      #            i++;
      #        }
      #    }
      #
      #    xRefImage.imageList(imageList);
      #}
    ENDSOURCE
  ENDMETHODS
  OBJECTBANK
    PROPERTIES
    ENDPROPERTIES
    
    DATASOURCE
      OBJECTPOOL
        PROPERTIES
          Name                #DEV_xRefElements
          Table               #DEV_xRefElements
          Index               #ImageResIdx
          AllowEdit           #No
          AllowCreate         #No
          AllowDelete         #No
        ENDPROPERTIES
        
        FIELDLIST
        ENDFIELDLIST
      ENDOBJECTPOOL
      METHODS
        SOURCE #executeQuery
          #public void executeQuery()
          #{
          #    // >> DEV:MXK >>
          #    QueryBuildDataSource    qbds;
          #    QueryBuildRange         qbrLabel;
          #    QueryBuildRange         qbrImgRes;
          #    QueryBuildRange         qbrEmbedded;
          #    QueryBuildRange         qbrType;
          #
          #    qbds        = this.queryBuildDataSource();
          #    qbrLabel    = SysQuery::findOrCreateRange(this.queryBuildDataSource(), fieldNum(DEV_xRefElements, Label));
          #    qbrImgRes   = SysQuery::findOrCreateRange(this.queryBuildDataSource(), fieldNum(DEV_xRefElements, ImageRes));
          #    qbrEmbedded = SysQuery::findOrCreateRange(this.queryBuildDataSource(), fieldNum(DEV_xRefElements, Embedded));
          #
          #    qbrEmbedded.value(SysQuery::value(CheckBoxEmbedded.checked() ? NoYes::Yes : NoYes::No));
          #    qbrEmbedded.status(RangeStatus::Locked);
          #
          #    if (SearchString.text())
          #    {
          #        if (CheckBoxEmbedded.checked())
          #        {
          #            qbrImgRes.value(SysQuery::value(SearchString.text()));
          #        }
          #        else
          #        {
          #            qbds.clearRange(qbrImgRes.field());
          #    // << DEV:MXK <<
          #            qbrLabel.value(strFmt('((%1 like "%2") || (%3 like "%2") || (%4 like "%2"))',
          #                    fieldStr(DEV_xRefElements, Label),
          #                    '*' + SearchString.text() + '*',
          #                    fieldStr(DEV_xRefElements, HelpText),
          #                    fieldStr(DEV_xRefElements, FullPath)));
          #        }
          #    }
          #    else
          #    {
          #        qbds.clearRange(qbrLabel.field());
          #    }
          #
          #    qbrType  = SysQuery::findOrCreateRange(qbds, fieldNum(DEV_xRefElements, Type));
          #    qbrType.value(SysQuery::value(UtilElementType::Resource));
          #
          #    super();
          #
          #    TotalFound.text(strFmt('Found in total: %1', SysQuery::countTotal(DEV_xRefElements_qr))); // DEV:MXK
          #}
        ENDSOURCE
        SOURCE #getCurImage
          #display ImageRes getCurImage(DEV_xRefElements _xRefElements)
          #{
          #    ImageRes        ret = 0;
          #
          #    if(Image::validResource(_xRefElements.ImageRes))
          #    {
          #        ret = resIdMap.lookup(_xRefElements.ImageRes);
          #    }
          #
          #    return ret;
          #}
        ENDSOURCE
      ENDMETHODS
    ENDDATASOURCE
  ENDOBJECTBANK
  
  REFERENCEDATASOURCES
  ENDREFERENCEDATASOURCES
  
  JOINS
  ENDJOINS
  
  PARTREFERENCES
  ENDPARTREFERENCES
  
  DESIGN
    PROPERTIES
      Caption             #Icons used by
      HideToolbar         #Yes
      SetCompany          #No
      StatusBarStyle      #Simple
    ENDPROPERTIES
    
    CONTAINER
      CONTROL BUTTONGROUP
        PROPERTIES
          Name                #ButtonGroup
          Height              #Column height
          ElementPosition     #1610612733
          HierarchyParent     #GridGroup
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL GRID
        PROPERTIES
          Name                #RefGrid
          Width               #Column width
          Height              #Column height
          ElementPosition     #1073741822
          HierarchyParent     #GridGroup
          DataSource          #DEV_xRefElements
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL GROUP
        PROPERTIES
          Name                #GridGroup
          Width               #Column width
          Height              #Column height
          ElementPosition     #1431655764
          FrameType           #None
          Columns             #2
          ArrangeGuide        
            ARRAY INDEX Columns 
              #0
              #0
            ENDARRAY
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL GROUP
        PROPERTIES
          Name                #TopGroup
          Width               #Column width
          Height              #Column height
          ElementPosition     #715827882
          FrameType           #None
          Columns             #5
          ArrangeGuide        
            ARRAY INDEX Columns 
              #0
              #0
              #0
              #0
              #0
            ENDARRAY
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL BUTTON
        PROPERTIES
          Name                #UpdateRef
          HelpText            #Update references
          ElementPosition     #1431655764
          HierarchyParent     #ButtonGroup
          Text                #Update
          NormalImage         #12338
          ImageLocation       #EmbeddedResource
        ENDPROPERTIES
        
        METHODS
          SOURCE #clicked
            #// >> DEV:MXK >>
            #void clicked()
            #{
            #    if (CheckBoxEmbedded.checked())
            #    {
            #        DEV_xRefIconSearch::updateEmbedded();
            #        DEV_xRefElements_ds.executeQuery();
            #    }
            #    // This operation may take several minutes.
            #    else if (Box::okCancel("@SYS315452", DialogButton::Cancel) == DialogButton::Ok)
            #    {
            #        DEV_xRefIconSearch::main(new Args());
            #        DEV_xRefElements_ds.executeQuery();
            #    }
            #}
            #// << DEV:MXK <<
          ENDSOURCE
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL CHECKBOX
        PROPERTIES
          Name                #CheckBoxEmbedded
          AutoDeclaration     #Yes
          ElementPosition     #1288490187
          HierarchyParent     #TopGroup
          Label               #@SYS89263
        ENDPROPERTIES
        
        METHODS
          SOURCE #clicked
            #// >> DEV:MXK >>
            #public void clicked()
            #{
            #    super();
            #
            #    EmbImage.visible(CheckBoxEmbedded.checked());
            #    xRefImage.visible(!CheckBoxEmbedded.checked());
            #    DEV_xRes_Label.visible(!CheckBoxEmbedded.checked());
            #    DEV_xRes_HelpText.visible(!CheckBoxEmbedded.checked());
            #    DEV_xRes_FullPath.visible(!CheckBoxEmbedded.checked());
            #    DEV_xRefElements_ds.executeQuery();
            #    SearchString.setFocus();
            #}
            #// << DEV:MXK <<
          ENDSOURCE
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL COMBOBOX
        PROPERTIES
          Name                #ElementType
          AllowEdit           #No
          Skip                #Yes
          ElementPosition     #572662304
          HierarchyParent     #TopGroup
          Selection           #21
          Label               #@SYS40518
          EnumType            #UtilElementType
          ComboType           #List
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL INTEDIT
        PROPERTIES
          Name                #DEV_xRes_ResourceId
          ElementPosition     #1073741820
          HierarchyParent     #RefGrid
          DataSource          #DEV_xRefElements
          DataField           #ImageRes
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL STATICTEXT
        PROPERTIES
          Name                #TotalFound
          AutoDeclaration     #Yes
          Left                #Auto (right)
          ElementPosition     #1717986916
          HierarchyParent     #TopGroup
          Text                #
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL STRINGEDIT
        PROPERTIES
          Name                #DEV_xRes_FullPath
          AutoDeclaration     #Yes
          Width               #Column width
          ElementPosition     #1879048185
          HierarchyParent     #RefGrid
          DataSource          #DEV_xRefElements
          DataField           #FullPath
        ENDPROPERTIES
        
        METHODS
          SOURCE #mouseDblClick
            #// >> DEV:MXK >>
            #public int mouseDblClick(int _x, int _y, int _button, boolean _Ctrl, boolean _Shift)
            #{
            #    int ret;
            #
            #    ret = super(_x, _y, _button, _Ctrl, _Shift);
            #
            #    DEV_AOTNodeExpander::expandNode(null, DEV_xRefElements.FullPath);
            #
            #    return ret;
            #}
            #// << DEV:MXK <<
          ENDSOURCE
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL STRINGEDIT
        PROPERTIES
          Name                #DEV_xRes_HelpText
          AutoDeclaration     #Yes
          ElementPosition     #1610612730
          HierarchyParent     #RefGrid
          DataSource          #DEV_xRefElements
          DataField           #HelpText
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL STRINGEDIT
        PROPERTIES
          Name                #DEV_xRes_Label
          AutoDeclaration     #Yes
          ElementPosition     #1342177275
          HierarchyParent     #RefGrid
          DataSource          #DEV_xRefElements
          DataField           #Label
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL STRINGEDIT
        PROPERTIES
          Name                #SearchString
          AutoDeclaration     #Yes
          ElementPosition     #858993458
          HierarchyParent     #TopGroup
          Label               #Search
        ENDPROPERTIES
        
        METHODS
          SOURCE #modified
            #public boolean modified()
            #{
            #    boolean ret;
            #
            #    ret = super();
            #
            #    DEV_xRefElements_ds.executeQuery();
            #
            #    return ret;
            #}
          ENDSOURCE
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL WINDOW
        PROPERTIES
          Name                #EmbImage
          AutoDeclaration     #Yes
          Visible             #No
          AllowEdit           #No
          Width               #40
          Height              #40
          Skip                #Yes
          AlignControl        #No
          ElementPosition     #805306365
          HierarchyParent     #RefGrid
          BackStyle           #Transparent
          Label               #@SYS58650
          DataSource          #DEV_xRefElements
          DataField           #ImageRes
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
      CONTROL WINDOW
        PROPERTIES
          Name                #xRefImage
          AutoDeclaration     #Yes
          AllowEdit           #No
          Width               #40
          Height              #40
          Skip                #Yes
          AlignControl        #No
          ElementPosition     #536870910
          HierarchyParent     #RefGrid
          BackStyle           #Transparent
          DataSource          #DEV_xRefElements
          DataMethod          #getCurImage
        ENDPROPERTIES
        
        METHODS
        ENDMETHODS
      ENDCONTROL 
      
    ENDCONTAINER
    
  ENDDESIGN
  
  PERMISSIONS #Permissions
    PROPERTIES
    ENDPROPERTIES
    
    PERMISSIONSET #Read
      PROPERTIES
      ENDPROPERTIES
      
      FORM #Controls
      ENDFORM
      
    TABLES #Tables
    ENDTABLES
    
  SERVERMETHODS #Server Methods
  ENDSERVERMETHODS
  
ASSOCIATEDFORMS #Associated Forms
ENDASSOCIATEDFORMS

ENDPERMISSIONSET

PERMISSIONSET #Update
  PROPERTIES
  ENDPROPERTIES
  
  FORM #Controls
  ENDFORM
  
TABLES #Tables
ENDTABLES

SERVERMETHODS #Server Methods
ENDSERVERMETHODS

ASSOCIATEDFORMS #Associated Forms
ENDASSOCIATEDFORMS

ENDPERMISSIONSET

PERMISSIONSET #Create
  PROPERTIES
  ENDPROPERTIES
  
  FORM #Controls
  ENDFORM
  
TABLES #Tables
ENDTABLES

SERVERMETHODS #Server Methods
ENDSERVERMETHODS

ASSOCIATEDFORMS #Associated Forms
ENDASSOCIATEDFORMS

ENDPERMISSIONSET

PERMISSIONSET #Delete
  PROPERTIES
  ENDPROPERTIES
  
  FORM #Controls
  ENDFORM
  
TABLES #Tables
ENDTABLES

SERVERMETHODS #Server Methods
ENDSERVERMETHODS

ASSOCIATEDFORMS #Associated Forms
ENDASSOCIATEDFORMS

ENDPERMISSIONSET

ENDPERMISSIONS

ENDFORM


***Element: END
